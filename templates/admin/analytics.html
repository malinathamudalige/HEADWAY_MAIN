<!-- templates/admin/analytics.html -->
{% extends "base.html" %}

{% block title %}Platform Analytics - Headway E-Learning{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="mb-8 flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Platform Analytics</h1>
            <p class="mt-2 text-gray-600">Comprehensive insights into platform performance and user engagement</p>
        </div>
        <div class="flex space-x-3">
        </div>
    </div>

    <!-- Key Performance Indicators -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="bg-gradient-to-r from-blue-500 to-blue-600 overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-users text-2xl text-white"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-blue-100 truncate">Total Users</dt>
                            <dd class="text-2xl font-bold text-white">{{ stats.total_users }}</dd>
                            <dd class="text-sm text-blue-100">+14% from last month</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-gradient-to-r from-green-500 to-green-600 overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-book text-2xl text-white"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-green-100 truncate">Active Courses</dt>
                            <dd class="text-2xl font-bold text-white">{{ stats.total_courses }}</dd>
                            <dd class="text-sm text-green-100">+3 new this month</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-gradient-to-r from-purple-500 to-purple-600 overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-graduation-cap text-2xl text-white"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-purple-100 truncate">Total Enrollments</dt>
                            <dd class="text-2xl font-bold text-white">{{ stats.total_enrollments }}</dd>
                            <dd class="text-sm text-purple-100">+22% from last month</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 overflow-hidden shadow rounded-lg">
            <div class="p-5">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fas fa-chart-line text-2xl text-white"></i>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-yellow-100 truncate">Completion Rate</dt>
                            <dd class="text-2xl font-bold text-white">{{ stats.completion_rate }}%</dd>
                            <dd class="text-sm text-yellow-100">+5.2% from last month</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts and Graphs Section -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        <!-- User Growth Chart -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                <h3 class="text-lg font-medium text-gray-900">User Growth Over Time</h3>
                <div class="flex space-x-2">
                    <button class="text-sm text-gray-500 hover:text-gray-700">Daily</button>
                    <button class="text-sm text-primary border-b-2 border-primary">Weekly</button>
                    <button class="text-sm text-gray-500 hover:text-gray-700">Monthly</button>
                </div>
            </div>
            <div class="p-6">
                <div class="h-80 flex items-center justify-center bg-gray-50 rounded-lg">
                    <div class="text-center">
                        <i class="fas fa-chart-line text-5xl text-gray-400 mb-4"></i>
                        <p class="text-gray-500 font-medium">User Growth Chart</p>
                        <p class="text-sm text-gray-400">Integration with Chart.js or D3.js</p>
                        <div class="mt-4 grid grid-cols-3 gap-4 text-sm">
                            <div class="bg-white p-3 rounded shadow">
                                <div class="text-lg font-bold text-blue-600">456</div>
                                <div class="text-gray-500">New Users</div>
                            </div>
                            <div class="bg-white p-3 rounded shadow">
                                <div class="text-lg font-bold text-green-600">89%</div>
                                <div class="text-gray-500">Retention</div>
                            </div>
                            <div class="bg-white p-3 rounded shadow">
                                <div class="text-lg font-bold text-purple-600">+18%</div>
                                <div class="text-gray-500">Growth</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Revenue Analytics -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">Revenue Analytics</h3>
            </div>
            <div class="p-6">
                <div class="h-80">
                    <!-- Revenue Summary Cards -->
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-gradient-to-r from-emerald-500 to-emerald-600 p-4 rounded-lg text-white">
                            <div class="text-sm opacity-80">Monthly Revenue</div>
                            <div class="text-2xl font-bold">$24,650</div>
                            <div class="text-sm opacity-80">+12% vs last month</div>
                        </div>
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-4 rounded-lg text-white">
                            <div class="text-sm opacity-80">Avg. Revenue per User</div>
                            <div class="text-2xl font-bold">$48.30</div>
                            <div class="text-sm opacity-80">+8% vs last month</div>
                        </div>
                    </div>

                    <!-- Revenue Chart Placeholder -->
                    <div class="h-40 bg-gray-50 rounded-lg flex items-center justify-center">
                        <div class="text-center">
                            <i class="fas fa-dollar-sign text-3xl text-gray-400 mb-2"></i>
                            <p class="text-gray-500">Revenue trend chart</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Course Performance Overview -->
    <div class="bg-white shadow rounded-lg mb-8">
        <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
            <h3 class="text-lg font-medium text-gray-900">Course Performance Overview</h3>
            <div class="flex items-center space-x-4">
                <select class="text-sm border-gray-300 rounded-md">
                    <option>All Courses</option>
                    <option>Published Only</option>
                    <option>Top Performing</option>
                </select>
                <button class="text-sm text-primary hover:text-blue-700">View All Courses</button>
            </div>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Instructor</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Enrollments</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Completion Rate</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rating</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Revenue</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for course_id, performance in course_performance.items() %}
                    {% set course = courses[course_id] %}
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <img class="h-10 w-10 rounded-lg object-cover"
                                     src="{{ course.image if course.image else 'https://images.unsplash.com/photo-1434030216411-0b793f4b4173?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&q=80' }}"
                                     alt="{{ course.title }}">
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">{{ course.title }}</div>
                                    <div class="text-sm text-gray-500">{{ course.level }} • {{ course.duration }}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <img class="h-8 w-8 rounded-full"
                                     src="https://ui-avatars.com/api/?name={{ course.instructor }}&background=3B82F6&color=fff"
                                     alt="{{ course.instructor }}">
                                <div class="ml-2 text-sm text-gray-900">{{ course.instructor }}</div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            <div class="flex items-center">
                                <i class="fas fa-users text-gray-400 mr-2"></i>
                                {{ course.students_enrolled }}
                                <span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                    +{{ (course.students_enrolled * 0.15)|round|int }} this month
                                </span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="text-sm font-medium text-gray-900">{{ performance.completion_rate }}%</div>
                                <div class="ml-3 w-20 bg-gray-200 rounded-full h-2">
                                    <div class="bg-green-500 h-2 rounded-full" style="width: {{ performance.completion_rate }}%"></div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <i class="fas fa-star text-yellow-400 mr-1"></i>
                                <span class="text-sm font-medium text-gray-900">{{ course.rating }}</span>
                                <span class="text-sm text-gray-500 ml-1">({{ course.students_enrolled }} reviews)</span>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            <div class="font-medium">${{ (course.students_enrolled * 49.99)|round(2) }}</div>
                            <div class="text-xs text-gray-500">This month</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                {% if course.status == 'published' %}bg-green-100 text-green-800
                                {% elif course.status == 'draft' %}bg-yellow-100 text-yellow-800
                                {% else %}bg-gray-100 text-gray-800{% endif %}">
                                {{ course.status.title() }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- User Engagement and Retention -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
        <!-- User Activity Heatmap -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">User Activity Heatmap</h3>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-7 gap-1 mb-4">
                    <div class="text-xs text-gray-500 text-center">Mon</div>
                    <div class="text-xs text-gray-500 text-center">Tue</div>
                    <div class="text-xs text-gray-500 text-center">Wed</div>
                    <div class="text-xs text-gray-500 text-center">Thu</div>
                    <div class="text-xs text-gray-500 text-center">Fri</div>
                    <div class="text-xs text-gray-500 text-center">Sat</div>
                    <div class="text-xs text-gray-500 text-center">Sun</div>
                </div>
                <!-- Heatmap Grid -->
                <div class="grid grid-cols-7 gap-1">
                    {% for i in range(28) %}
                    <div class="h-8 w-8 rounded {{ ['bg-gray-100', 'bg-blue-200', 'bg-blue-400', 'bg-blue-600'][range(4)|random] }} hover:bg-blue-700 transition-colors cursor-pointer"
                         title="Day {{ i+1 }}: {{ range(50, 200)|random }} active users"></div>
                    {% endfor %}
                </div>
                <div class="mt-4 flex items-center justify-between text-xs text-gray-500">
                    <span>Less</span>
                    <div class="flex space-x-1">
                        <div class="h-3 w-3 bg-gray-100 rounded"></div>
                        <div class="h-3 w-3 bg-blue-200 rounded"></div>
                        <div class="h-3 w-3 bg-blue-400 rounded"></div>
                        <div class="h-3 w-3 bg-blue-600 rounded"></div>
                    </div>
                    <span>More</span>
                </div>
            </div>
        </div>

        <!-- User Demographics -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">User Demographics</h3>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <!-- Role Distribution -->
                    <div>
                        <div class="flex justify-between text-sm mb-2">
                            <span>Students</span>
                            <span>78%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-500 h-2 rounded-full" style="width: 78%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-sm mb-2">
                            <span>Educators</span>
                            <span>15%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-green-500 h-2 rounded-full" style="width: 15%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-sm mb-2">
                            <span>Content Managers</span>
                            <span>5%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-purple-500 h-2 rounded-full" style="width: 5%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-sm mb-2">
                            <span>Administrators</span>
                            <span>2%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-red-500 h-2 rounded-full" style="width: 2%"></div>
                        </div>
                    </div>
                </div>

                <!-- Geographic Distribution -->
                <div class="mt-6">
                    <h4 class="text-sm font-medium text-gray-900 mb-3">Top Locations</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span>🇱🇰 Sri Lanka</span>
                            <span>45%</span>
                        </div>
                        <div class="flex justify-between">
                            <span>🇺🇸 United States</span>
                            <span>22%</span>
                        </div>
                        <div class="flex justify-between">
                            <span>🇬🇧 United Kingdom</span>
                            <span>18%</span>
                        </div>
                        <div class="flex justify-between">
                            <span>🇦🇺 Australia</span>
                            <span>15%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Health -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">System Health</h3>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <!-- Server Status -->
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-green-400 rounded-full mr-3"></div>
                            <span class="text-sm text-gray-900">Server Status</span>
                        </div>
                        <span class="text-sm font-medium text-green-600">Operational</span>
                    </div>

                    <!-- Database Performance -->
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-green-400 rounded-full mr-3"></div>
                            <span class="text-sm text-gray-900">Database</span>
                        </div>
                        <span class="text-sm font-medium text-green-600">Healthy</span>
                    </div>

                    <!-- API Response Time -->
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-yellow-400 rounded-full mr-3"></div>
                            <span class="text-sm text-gray-900">API Response</span>
                        </div>
                        <span class="text-sm font-medium text-yellow-600">245ms avg</span>
                    </div>

                    <!-- Error Rate -->
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-green-400 rounded-full mr-3"></div>
                            <span class="text-sm text-gray-900">Error Rate</span>
                        </div>
                        <span class="text-sm font-medium text-green-600">0.02%</span>
                    </div>
                </div>

                <!-- Performance Metrics -->
                <div class="mt-6">
                    <h4 class="text-sm font-medium text-gray-900 mb-3">Performance Metrics</h4>
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between text-xs mb-1">
                                <span>CPU Usage</span>
                                <span>23%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-1.5">
                                <div class="bg-blue-500 h-1.5 rounded-full" style="width: 23%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-xs mb-1">
                                <span>Memory</span>
                                <span>67%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-1.5">
                                <div class="bg-yellow-500 h-1.5 rounded-full" style="width: 67%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-xs mb-1">
                                <span>Storage</span>
                                <span>34%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-1.5">
                                <div class="bg-green-500 h-1.5 rounded-full" style="width: 34%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions and Alerts -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Recent Alerts -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">System Alerts</h3>
            </div>
            <div class="p-6">
                <div class="space-y-3">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-yellow-600 text-sm"></i>
                            </div>
                        </div>
                        <div class="ml-3 flex-1">
                            <p class="text-sm text-gray-900">High memory usage detected on server cluster 2</p>
                            <p class="text-xs text-gray-500">2 hours ago • Low Priority</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-check text-green-600 text-sm"></i>
                            </div>
                        </div>
                        <div class="ml-3 flex-1">
                            <p class="text-sm text-gray-900">Database backup completed successfully</p>
                            <p class="text-xs text-gray-500">6 hours ago • Info</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-info text-blue-600 text-sm"></i>
                            </div>
                        </div>
                        <div class="ml-3 flex-1">
                            <p class="text-sm text-gray-900">New feature deployment scheduled for maintenance window</p>
                            <p class="text-xs text-gray-500">1 day ago • Scheduled</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>


                </div>
            </div>



{% endblock %}